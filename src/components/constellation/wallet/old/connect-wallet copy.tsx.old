import { Button } from "@mui/material";
import useIsAllowed from "../../../hooks/useIsAllowed";
import { useEffect, useState } from "react";
import SelectedWallet from "./select-wallet";
import usePublicKey from "../../../hooks/usePublicKey";
import { formatAddress } from "../../../utils";

const WalletButton = () => {
  const [open, setOpen] = useState(false);
  const {allowed, setAllowed} = useIsAllowed();
  const { publicKey } = usePublicKey();
 
  const [key, setKey] = useState('')

  useEffect(() => { 
 
    if(publicKey) {
        setKey(publicKey)
    }

  }, [publicKey,allowed])
  
  const handleOnConnect = (address: string) => {
 
     setKey(address)
     setAllowed(true)
  }
  const handleClick = () => {
    setOpen(true);
  };
 

  return (
    <>
      <SelectedWallet open={open} onClose={() => setOpen(false)} onConnect={handleOnConnect} />
      <Button variant="contained" onClick={handleClick}>{!allowed ? "Connect" : formatAddress(key)}</Button>
    </>
  );
};

export default WalletButton;
