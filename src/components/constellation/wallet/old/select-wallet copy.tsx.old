import Avatar from "@mui/material/Avatar";
import List from "@mui/material/List";
import ListItem from "@mui/material/ListItem";
import ListItemAvatar from "@mui/material/ListItemAvatar";
import ListItemButton from "@mui/material/ListItemButton";
import ListItemText from "@mui/material/ListItemText";
import DialogTitle from "@mui/material/DialogTitle";
import Dialog from "@mui/material/Dialog";
import PersonIcon from "@mui/icons-material/Person";
import AddIcon from "@mui/icons-material/Add";
import { blue } from "@mui/material/colors";
import FreighterIcon from "./freighter-icon";
import useIsDetected from "../../../hooks/useIsDetected";
import { getPublicKey, setAllowed } from "@stellar/freighter-api";

const emails = ["username@gmail.com", "user02@gmail.com"];

export interface Props {
  open: boolean;
  onConnect: (value: string) => void;
  onClose: () => void;
}

function SelectedWallet(props: Props) {
  const { onClose, open } = props;
  const detected = useIsDetected();

  const handleListItemClick = async () => {
    // onClose(value);
     if(detected) {
          const result = await setAllowed();
          if(result) {
            const publicKey = await getPublicKey();
             props.onConnect(publicKey)
          }
     } else {
 
      window.open('https://www.freighter.app/', '_blank');
     }
  };


  return (
    <Dialog onClose={() => onClose()} open={open}>
      <DialogTitle>Connect your wallet to continue</DialogTitle>
      <List sx={{ pt: 0 }}>
     
          <ListItem disableGutters >
            <ListItemButton onClick={() => handleListItemClick()}>
              <ListItemAvatar>
                {/* <Avatar sx={{ bgcolor: blue[100], color: blue[600] }}> */}
                  <FreighterIcon sx={{borderRadius:'10px', padding:'20px'}}/>
                  {/* <PersonIcon /> */}
                {/* </Avatar> */}
              </ListItemAvatar>
              <ListItemText primary={"Freighter Wallet"} />
              <ListItemText primary={detected ? "Connect" : "Install"} />
            </ListItemButton>
          </ListItem>
    
        <ListItem disableGutters>
          <ListItemButton
            autoFocus
          
          >
            <ListItemAvatar>
              <Avatar>
                <AddIcon />
              </Avatar>
            </ListItemAvatar>
            <ListItemText primary="Add account" />
          </ListItemButton>
        </ListItem>
      </List>
    </Dialog>
  );
}

export default SelectedWallet;